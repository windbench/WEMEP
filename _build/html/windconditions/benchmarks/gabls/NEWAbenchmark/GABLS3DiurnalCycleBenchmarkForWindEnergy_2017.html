
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>GABLS 3 Diurnal-Cycle Benchmark for Wind Energy Applications &#8212; Wind Energy Model Evaluation Protocol</title>
    <link rel="stylesheet" href="../../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Assessment of meso-micro offline coupling methodology based on driving CFDWind single-column-model with WRF tendencies: the GABLS3 diurnal cycle case" href="../WES paper/GABLS3_CFDWind1D.html" />
    <link rel="prev" title="GABLS3 Diurnal Cycle in Flat Terrain Leading to a Nocturnal Low-Level Jet" href="../gabls3.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
  <div class="documentwrapper">
    <div class="bodywrapper">
      <div class="body" role="main">
          
          <div class="breadcrumbs">
            
            
              <a href="../../../../index.html">Home</a> &raquo;
                
                  <a href="../../../index.html">Wind Conditions</a> &raquo;
                
                  <a href="../gabls.html">GABLS Atmospheric Boundary Layer</a> &raquo;
                
                  <a href="../gabls3.html">GABLS3 Diurnal Cycle in Flat Terrain Leading to a Nocturnal Low-Level Jet</a> &raquo;
                
            
          </div>
        
        
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 8ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }
</style>
<div class="section" id="GABLS-3-Diurnal-Cycle-Benchmark-for-Wind-Energy-Applications">
<h1>GABLS 3 Diurnal-Cycle Benchmark for Wind Energy Applications<a class="headerlink" href="#GABLS-3-Diurnal-Cycle-Benchmark-for-Wind-Energy-Applications" title="Permalink to this headline">¶</a></h1>
<p>Javier Sanz Rodrigo, National Renewable Energy Centre (CENER),
Sarriguren, Spain, <a class="reference external" href="mailto:jsrodrigo&#37;&#52;&#48;cener&#46;com">jsrodrigo<span>&#64;</span>cener<span>&#46;</span>com</a></p>
<p>May 2017</p>
<div class="section" id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h2>
<p>This benchmark report analyzes the simulations submitted to the GABLS3
benchmark for wind energy, organized within the NEWA project and the IEA
Task 31 Wakebench. The results of this benchmark have been published in:</p>
<p><strong>Sanz Rodrigo J., Allaerts D., Ávila M., Barçons J., Cavar D., Chávez
Arroyo R.A., Churchfield M., Draper M., Kosovic B., Lundquist J.K.,
Meyers J., Muñoz Esparza D., Palma J.M.L.M., Tomazewski J.M., Troldborg
N., van der Laan M.P. and Veiga Rodrigues C. (2017) Results of the
GABLS3 diurnal cycle benchmark for wind energy applications. Journal of
Physics: Conference Series</strong></p>
</div>
<div class="section" id="Benchmark-Set-Up">
<h2>Benchmark Set-Up<a class="headerlink" href="#Benchmark-Set-Up" title="Permalink to this headline">¶</a></h2>
<p>Background information and benchmark set-up can be found in:
<a class="reference external" href="http://windbench.net/gabls-3">http://windbench.net/gabls-3</a></p>
</div>
<div class="section" id="Simulations">
<h2>Simulations<a class="headerlink" href="#Simulations" title="Permalink to this headline">¶</a></h2>
<p>The following simulations participate in the benchmark. Notice that
<em>WRF-YSU (ref)</em> is the reference mesoscale simulation that was used to
generate the mesoscale tendencies that are used as forcings for the
microscale models. Additional WRF simulations have been run to test the
sensitivity of mesoscale simulations to input forcing and planetary
boundary layer (PBL) scheme. The ensemble mean of these WRF simulations
is also used in the model intercomparison.</p>
<p><strong>Table 1. Summary of model simulations. Monin Obukhov similarity theory
(Monin-Obukhov (MOST) surface boundary conditions use either heat flux
(:math:`H`), 2-m (:math:`T_{2}`) or skin temperature (:math:`T_{SK}`)
from WRF.</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Input</th>
<th class="head">Turbulence</th>
<th class="head">z-Levels</th>
<th class="head">Surface
B.C.</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>WRF-YSU
(ref)</td>
<td>ERA-Interim</td>
<td>YSU</td>
<td>46</td>
<td>Noah</td>
</tr>
<tr class="row-odd"><td>WRF</td>
<td>ERA-Interim
,
GFS</td>
<td>MJY, MYNN,
QNSE, TEMF,
YSU</td>
<td>46</td>
<td>Noah</td>
</tr>
<tr class="row-even"><td>WRF-YSU_LES</td>
<td>ERA-Interim</td>
<td>LES-TKE</td>
<td>101</td>
<td>Noah</td>
</tr>
<tr class="row-odd"><td>WRF-VentosM
_ke</td>
<td>ERA-Interim</td>
<td>YSU/:math
:<cite>k-epsilo
n</cite></td>
<td>70</td>
<td>MOST, <em>H</em></td>
</tr>
<tr class="row-even"><td>CFDWind1D_k
e</td>
<td>WRF (ref)</td>
<td><span class="math">\(k-\e
psilon\)</span></td>
<td>301</td>
<td>MOST,
<span class="math">\(T_2\)</span></td>
</tr>
<tr class="row-odd"><td>Alya-CFDWin
d1D_ke</td>
<td>WRF (ref)</td>
<td><span class="math">\(k-\e
psilon\)</span></td>
<td>500</td>
<td>MOST,
<span class="math">\(T_2\)</span></td>
</tr>
<tr class="row-even"><td><a href="#id1"><span class="problematic" id="id2">Ellipsys1D_</span></a>
ke</td>
<td>WRF (ref)</td>
<td><span class="math">\(k-\e
psilon\)</span></td>
<td>512</td>
<td>MOST,
<span class="math">\(T_2\)</span></td>
</tr>
<tr class="row-odd"><td><a href="#id3"><span class="problematic" id="id4">Ellipsys3D_</span></a>
ke</td>
<td>WRF (ref)</td>
<td><span class="math">\(k-\e
psilon\)</span></td>
<td>192</td>
<td>MOST,
<span class="math">\(T_{S
K}\)</span></td>
</tr>
<tr class="row-even"><td><a href="#id5"><span class="problematic" id="id6">Ellipsys3D_</span></a>
LES</td>
<td>WRF (ref)</td>
<td><em>Smagorinsk
y</em></td>
<td>128</td>
<td>MOST,
<span class="math">\(T_{S
K}\)</span></td>
</tr>
<tr class="row-odd"><td>SP-Wind_LES</td>
<td>WRF (ref)</td>
<td>LES-TKE</td>
<td>500</td>
<td>MOST,
<span class="math">\(T_2\)</span></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="Load-libraries-and-define-input-data">
<h2>Load libraries and define input data<a class="headerlink" href="#Load-libraries-and-define-input-data" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="kn">as</span> <span class="nn">mdates</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">spatial</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">netCDF4</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
<span class="kn">import</span> <span class="nn">scipy.integrate</span> <span class="kn">as</span> <span class="nn">integrate</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="kn">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Constants</span>
<span class="n">K</span>       <span class="o">=</span> <span class="mf">0.41</span>            <span class="c1"># von Karman constant</span>
<span class="n">g</span>       <span class="o">=</span> <span class="mf">9.81</span>            <span class="c1"># [m s-2]</span>
<span class="n">R_air</span>   <span class="o">=</span> <span class="mf">287.058</span>         <span class="c1"># Specific gas constant for dry air [J kg-1 K-1]</span>
<span class="n">Cp_air</span>  <span class="o">=</span> <span class="mi">1005</span>            <span class="c1"># Specific heat of air [J kg-1 K-1]</span>
<span class="n">P0</span>      <span class="o">=</span> <span class="mf">100000.</span>         <span class="c1"># Reference pressure [Pa]</span>

<span class="c1"># Site ID</span>
<span class="n">siteID</span> <span class="o">=</span> <span class="s1">&#39;GABLS3&#39;</span>
<span class="n">lat_s</span> <span class="o">=</span> <span class="mf">51.971</span>   <span class="c1"># degrees N</span>
<span class="n">lon_s</span> <span class="o">=</span> <span class="mf">4.927</span>    <span class="c1"># degrees E</span>

<span class="c1"># Evaluation Period and reference Rotor chararcteristics</span>
<span class="n">datefrom</span>  <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2006</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>       <span class="c1"># Origin of evaluation period</span>
<span class="n">dateto</span>    <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2006</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>       <span class="c1"># End of evaluation period</span>
<span class="n">Hhub</span> <span class="o">=</span> <span class="mf">120.</span>         <span class="c1"># hub-height</span>
<span class="n">Drot</span> <span class="o">=</span> <span class="mf">160.</span>         <span class="c1"># rotor diameter</span>
<span class="n">ts</span> <span class="o">=</span> <span class="mi">10</span>             <span class="c1"># sampling frequency to evaluate [min]</span>

<span class="c1"># Mesoscale tendencies averaging settings</span>
<span class="n">tav</span> <span class="o">=</span> <span class="mf">60.0</span>          <span class="c1"># Time averaging time used in simulations [min]</span>
<span class="n">Lav</span> <span class="o">=</span> <span class="mf">9000.0</span>        <span class="c1"># Spatial averaging [m]</span>

<span class="n">ws</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tav</span><span class="o">/</span><span class="n">ts</span><span class="p">)</span>    <span class="c1"># rolling window size</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Load-Simulation-data">
<h2>Load Simulation data<a class="headerlink" href="#Load-Simulation-data" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [12]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">dirsim</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>
<span class="n">filesim</span> <span class="o">=</span> <span class="p">[</span><span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/GABLS3_tendencies_d02_YSU_w60_L9000.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/WRF-LES_d8.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/VentosM.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/CFDWindSCM_ke.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/Alya-CFDWind1D.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/Ellipsys1D_TskWRF.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/Ellipsys3D_TskWRF.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/Ellipsys3D_LES_TskWRF.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/SP-Wind.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/WRF-YSU_GFS.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/WRF-YSU_ERA.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/WRF-TEMF_GFS.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/WRF-TEMF_ERA.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/WRF-QNSE_GFS.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/WRF-QNSE_ERA.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/WRF-MYNN_GFS.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/WRF-MYNN_ERA.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/WRF-MJY_GFS.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/WRF-MJY_ERA.nc&#39;</span><span class="p">,</span>
           <span class="p">]</span>

<span class="n">simID</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;WRF-YSU (ref)&#39;</span><span class="p">,</span><span class="s1">&#39;WRF-YSU_LES&#39;</span><span class="p">,</span><span class="s1">&#39;VentosM&#39;</span><span class="p">,</span>
         <span class="s1">&#39;CFDWind1D_ke&#39;</span><span class="p">,</span><span class="s1">&#39;Alya-Wind1D_ke&#39;</span><span class="p">,</span><span class="s1">&#39;Ellipsys1D_ke&#39;</span><span class="p">,</span>
         <span class="s1">&#39;Ellipsys3D_ke&#39;</span><span class="p">,</span>
         <span class="s1">&#39;Ellipsys3D_LES&#39;</span><span class="p">,</span><span class="s1">&#39;SP-Wind_LES&#39;</span><span class="p">,</span>
         <span class="s1">&#39;WRF-YSU_GFS&#39;</span><span class="p">,</span><span class="s1">&#39;WRF-YSU_ERA&#39;</span><span class="p">,</span>
         <span class="s1">&#39;WRF-TEMF_GFS&#39;</span><span class="p">,</span><span class="s1">&#39;WRF-TEMF_ERA&#39;</span><span class="p">,</span>
         <span class="s1">&#39;WRF-QNSE_GFS&#39;</span><span class="p">,</span><span class="s1">&#39;WRF-QNSE_ERA&#39;</span><span class="p">,</span>
         <span class="s1">&#39;WRF-MYNN_GFS&#39;</span><span class="p">,</span><span class="s1">&#39;WRF-MYNN_ERA&#39;</span><span class="p">,</span>
         <span class="s1">&#39;WRF-MJY_GFS&#39;</span><span class="p">,</span><span class="s1">&#39;WRF-MJY_ERA&#39;</span><span class="p">,</span>
         <span class="p">]</span>

<span class="n">simtype</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;meso&#39;</span><span class="p">,</span><span class="s1">&#39;micro&#39;</span><span class="p">,</span><span class="s1">&#39;micro&#39;</span><span class="p">,</span>
           <span class="s1">&#39;micro&#39;</span><span class="p">,</span><span class="s1">&#39;micro&#39;</span><span class="p">,</span><span class="s1">&#39;micro&#39;</span><span class="p">,</span>
           <span class="s1">&#39;micro&#39;</span><span class="p">,</span>
           <span class="s1">&#39;micro&#39;</span><span class="p">,</span><span class="s1">&#39;micro&#39;</span><span class="p">,</span>
           <span class="s1">&#39;meso&#39;</span><span class="p">,</span><span class="s1">&#39;meso&#39;</span><span class="p">,</span>
           <span class="s1">&#39;meso&#39;</span><span class="p">,</span><span class="s1">&#39;meso&#39;</span><span class="p">,</span>
           <span class="s1">&#39;meso&#39;</span><span class="p">,</span><span class="s1">&#39;meso&#39;</span><span class="p">,</span>
           <span class="s1">&#39;meso&#39;</span><span class="p">,</span><span class="s1">&#39;meso&#39;</span><span class="p">,</span>
           <span class="s1">&#39;meso&#39;</span><span class="p">,</span><span class="s1">&#39;meso&#39;</span><span class="p">,</span>
           <span class="p">]</span>

<span class="n">Nsim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">filesim</span><span class="p">)</span>

<span class="c1"># Create a list with the simulation datasets</span>
<span class="n">t</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">U</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">V</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">Th</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">z</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">S</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">WD</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">us</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">wt</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">T2</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">TKE</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">isim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Nsim</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">filesim</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">times</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][:]</span>
    <span class="n">idates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">times</span> <span class="o">&gt;=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">datefrom</span><span class="p">),</span> <span class="n">times</span> <span class="o">&lt;</span> <span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">dateto</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">]))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">U</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;U&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">,:],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">]))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">V</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">,:],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">]))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">Th</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Th&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">,:],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">]))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">][:])</span>
    <span class="n">S</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">U</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">V</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">WD</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">180</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="n">V</span><span class="p">[</span><span class="n">isim</span><span class="p">])</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">us</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ust&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">]))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">wt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;wt&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">]))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">T2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;T2&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">]))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">simtype</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;micro&#39;</span><span class="p">:</span>
        <span class="n">TKE</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;TKE&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">,:],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">]))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">TKE</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">U</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">U</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Create ensemble from WRF simulations</span>
<span class="n">simID</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;WRF-Ensemble&#39;</span><span class="p">)</span>
<span class="n">simtype</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;meso&#39;</span><span class="p">)</span>
<span class="n">Nsim</span> <span class="o">=</span> <span class="n">Nsim</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">U</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">18</span><span class="p">]),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">2</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">U</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">U</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
<span class="n">V</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">18</span><span class="p">]),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">2</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">U</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">U</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
<span class="n">S</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">U</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">U</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">V</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">U</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">WD</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">180</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">U</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">V</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">U</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">Th</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span><span class="n">Th</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">18</span><span class="p">]),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">2</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">U</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">U</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
<span class="n">TKE</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span><span class="n">TKE</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">18</span><span class="p">]),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">2</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">U</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">U</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
<span class="n">us</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span><span class="n">us</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">18</span><span class="p">]),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">U</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
<span class="n">wt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span><span class="n">wt</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">18</span><span class="p">]),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">U</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
<span class="n">T2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span><span class="n">T2</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">18</span><span class="p">]),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">U</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
<span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">18</span><span class="p">])</span>
<span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="mi">18</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Load-Observations">
<h2>Load Observations<a class="headerlink" href="#Load-Observations" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [13]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># Note that the file &#39;gabls3_scm_cabauw_obs_v33.nc&#39; can be obtained from the KNMI GABLS3 website</span>
<span class="c1"># http://projects.knmi.nl/gabls/gabls3_scm_cabauw_obs_v33.nc</span>
<span class="c1"># Alternatively, it is also provided in the Windbench/GABLS3 input dataset</span>

<span class="n">dirobs</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>
<span class="n">fileobs</span> <span class="o">=</span> <span class="n">dirobs</span> <span class="o">+</span> <span class="s1">&#39;/gabls3_scm_cabauw_obs_v33.nc&#39;</span>
<span class="n">nodata</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9999.0</span>                          <span class="c1"># missing data flag</span>
<span class="n">date0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2006</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># origin of time_obs</span>

<span class="n">f1</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">fileobs</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">dates_obs</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">][:]</span>
<span class="n">time_obs</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][:]</span>   <span class="c1"># &#39;hours since 2006-07-01 00:00:00 0:00&#39;</span>

<span class="n">date_obs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">time_obs</span><span class="p">)):</span>
    <span class="n">date_obs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date0</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">time_obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="mf">3600.0</span><span class="p">)))</span>

<span class="n">ifrom_obs</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">date_obs</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">date_obs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">datefrom</span><span class="p">:</span>
        <span class="n">ifrom_obs</span> <span class="o">=</span> <span class="n">j</span>
<span class="n">ito_obs</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">date_obs</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">date_obs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dateto</span><span class="p">:</span>
        <span class="n">ito_obs</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span>

<span class="n">date_obs</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">date_obs</span><span class="p">[</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">])</span>
<span class="n">time_obs</span> <span class="o">=</span> <span class="mf">24.0</span><span class="o">*</span><span class="p">(</span><span class="n">date_obs</span> <span class="o">-</span> <span class="n">date_obs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Surface variables</span>
<span class="n">ustar_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ustar&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ustar&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">U10_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;u10m&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;u10m&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">V10_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v10m&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v10m&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">S10_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;f10m&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;f10m&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">WD10_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;d10m&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;d10m&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">T2_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">HFX_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;shf&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;shf&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">Ts_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">zs_obs</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;zs&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">][</span><span class="mi">0</span><span class="p">,:]</span>   <span class="c1"># soil temperature heights [m]</span>
<span class="n">Tsk_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;tsk&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;tsk&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">Tsk1_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;tsk1&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;tsk1&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>

<span class="c1"># Vertical profiles</span>
<span class="n">zf_obs</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;zf&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">][</span><span class="mi">0</span><span class="p">,:]</span>   <span class="c1"># velocity profile heights [m]</span>
<span class="n">zT_obs</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;zt&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">][</span><span class="mi">0</span><span class="p">,:]</span>   <span class="c1"># temperature profile heights [m]</span>
<span class="n">U_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">V_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">S_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>  <span class="c1"># horizontal wind speed [deg]</span>
<span class="n">WD_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span> <span class="c1"># wind direction [deg]</span>
<span class="n">Th_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;th&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;th&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>   <span class="c1"># potential temperature [K]</span>
<span class="n">q_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>

<span class="c1"># fluxes</span>
<span class="n">zh_obs</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;zh&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">][</span><span class="mi">0</span><span class="p">,:]</span>   <span class="c1"># fluxes heights</span>
<span class="n">wt_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;wt&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;wt&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">uw_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;uw&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;uw&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">vw_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;vw&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;vw&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">us_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">uw_obs</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vw_obs</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.25</span>

<span class="c1"># Obukhov length</span>
<span class="n">T0_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">Th_obs</span><span class="p">[</span><span class="mi">36</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
<span class="n">L_obs</span> <span class="o">=</span> <span class="o">-</span><span class="n">us_obs</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="p">(</span><span class="n">K</span><span class="o">*</span><span class="p">(</span><span class="n">g</span><span class="o">/</span><span class="n">T0_obs</span><span class="p">)</span><span class="o">*</span><span class="n">wt_obs</span><span class="p">)</span>

<span class="c1"># Resample and apply tav to observations</span>
<span class="n">ws</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tav</span><span class="o">/</span><span class="n">ts</span><span class="p">)</span>  <span class="c1"># rolling window size</span>
<span class="n">ustar_obs_w</span> <span class="o">=</span> <span class="n">ustar_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">HFX_obs_w</span> <span class="o">=</span> <span class="n">HFX_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">U10_obs_w</span> <span class="o">=</span> <span class="n">U10_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">V10_obs_w</span> <span class="o">=</span> <span class="n">V10_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">S10_obs_w</span> <span class="o">=</span> <span class="n">S10_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">WD10_obs_w</span> <span class="o">=</span> <span class="n">WD10_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">T2_obs_w</span> <span class="o">=</span> <span class="n">T2_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">Ts_obs_w</span> <span class="o">=</span> <span class="n">Ts_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">U_obs_w</span> <span class="o">=</span> <span class="n">U_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">V_obs_w</span> <span class="o">=</span> <span class="n">V_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">S_obs_w</span> <span class="o">=</span> <span class="n">S_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">WD_obs_w</span> <span class="o">=</span> <span class="n">WD_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">Th_obs_w</span> <span class="o">=</span> <span class="n">Th_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">q_obs_w</span> <span class="o">=</span> <span class="n">q_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">wt_obs_w</span> <span class="o">=</span> <span class="n">wt_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">uw_obs_w</span> <span class="o">=</span> <span class="n">uw_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">vw_obs_w</span> <span class="o">=</span> <span class="n">vw_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">us_obs_w</span> <span class="o">=</span> <span class="n">us_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">L_obs_w</span> <span class="o">=</span> <span class="n">L_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">TKE_obs_w</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">U_obs_w</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">U_obs_w</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<div class="section" id="Plot-tz-contours">
<h2>Plot tz contours<a class="headerlink" href="#Plot-tz-contours" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [14]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># List simulations for index reference</span>
<span class="k">for</span> <span class="n">isim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">simID</span><span class="p">)):</span>
    <span class="k">print</span> <span class="n">isim</span><span class="p">,</span> <span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0 WRF-YSU (ref)
1 WRF-YSU_LES
2 VentosM
3 CFDWind1D_ke
4 Alya-Wind1D_ke
5 Ellipsys1D_ke
6 Ellipsys3D_ke
7 Ellipsys3D_LES
8 SP-Wind_LES
9 WRF-YSU_GFS
10 WRF-YSU_ERA
11 WRF-TEMF_GFS
12 WRF-TEMF_ERA
13 WRF-QNSE_GFS
14 WRF-QNSE_ERA
15 WRF-MYNN_GFS
16 WRF-MYNN_ERA
17 WRF-MJY_GFS
18 WRF-MJY_ERA
19 WRF-Ensemble
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [15]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># Select the simulations you want to plot</span>
<span class="n">plotsim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>

<span class="c1"># Plot settings</span>
<span class="n">zlim</span> <span class="o">=</span> <span class="mi">2000</span>                                   <span class="c1"># height limit [m]</span>
<span class="n">Zcmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>                   <span class="c1"># colormap</span>
<span class="n">figname</span> <span class="o">=</span> <span class="n">siteID</span><span class="o">+</span><span class="s1">&#39;_tzfields.png&#39;</span>              <span class="c1"># output filename</span>
<span class="n">Zlevels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">),</span>     <span class="c1"># range for S</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">210</span><span class="p">,</span><span class="mi">13</span><span class="p">),</span>   <span class="c1"># range for WD</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">285</span><span class="p">,</span><span class="mi">305</span><span class="p">,</span><span class="mi">11</span><span class="p">),</span>  <span class="c1"># range for Th</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">11</span><span class="p">)])</span>     <span class="c1"># range for TKE</span>

<span class="n">X</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">Y</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">Z</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">taxis</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">zaxis</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">Ztitle</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Z</span> <span class="o">=</span> <span class="p">[</span><span class="n">S_obs_w</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">WD_obs_w</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">Th_obs_w</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">TKE_obs_w</span><span class="o">.</span><span class="n">T</span><span class="p">]</span>
<span class="p">[</span><span class="n">Xf</span><span class="p">,</span><span class="n">Yf</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">date_obs</span><span class="p">,</span><span class="n">zf_obs</span><span class="p">)</span>
<span class="p">[</span><span class="n">XT</span><span class="p">,</span><span class="n">YT</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">date_obs</span><span class="p">,</span><span class="n">zT_obs</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="n">Xf</span><span class="p">,</span> <span class="n">Xf</span><span class="p">,</span> <span class="n">XT</span><span class="p">,</span> <span class="n">Xf</span><span class="p">]</span>
<span class="n">Y</span> <span class="o">=</span> <span class="p">[</span><span class="n">Yf</span><span class="p">,</span> <span class="n">Yf</span><span class="p">,</span> <span class="n">YT</span><span class="p">,</span> <span class="n">Yf</span><span class="p">]</span>
<span class="n">taxis</span> <span class="o">=</span> <span class="p">[</span><span class="n">date_obs</span><span class="p">,</span> <span class="n">date_obs</span><span class="p">,</span> <span class="n">date_obs</span><span class="p">,</span> <span class="n">date_obs</span><span class="p">]</span>
<span class="n">zaxis</span> <span class="o">=</span> <span class="p">[</span><span class="n">zf_obs</span><span class="p">,</span> <span class="n">zf_obs</span><span class="p">,</span> <span class="n">zT_obs</span><span class="p">,</span> <span class="n">zf_obs</span><span class="p">]</span>
<span class="n">Ztitle</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Observations&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">plotsim</span><span class="p">)):</span>
    <span class="n">isim</span> <span class="o">=</span> <span class="n">plotsim</span><span class="p">[</span><span class="n">ip</span><span class="p">]</span>
    <span class="n">Z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="p">[</span><span class="n">X0</span><span class="p">,</span><span class="n">Y0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">])</span>
    <span class="n">taxis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">]);</span> <span class="n">zaxis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">]);</span> <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X0</span><span class="p">);</span> <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Y0</span><span class="p">)</span>
    <span class="n">Z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WD</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="p">[</span><span class="n">X0</span><span class="p">,</span><span class="n">Y0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">])</span>
    <span class="n">taxis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">]);</span> <span class="n">zaxis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">]);</span> <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X0</span><span class="p">);</span> <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Y0</span><span class="p">)</span>
    <span class="n">Z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Th</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="p">[</span><span class="n">X0</span><span class="p">,</span><span class="n">Y0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">])</span>
    <span class="n">taxis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">]);</span> <span class="n">zaxis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">]);</span> <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X0</span><span class="p">);</span> <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Y0</span><span class="p">)</span>
    <span class="n">Z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TKE</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="p">[</span><span class="n">X0</span><span class="p">,</span><span class="n">Y0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">])</span>
    <span class="n">taxis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">]);</span> <span class="n">zaxis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">]);</span> <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X0</span><span class="p">);</span> <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Y0</span><span class="p">)</span>
    <span class="n">Ztitle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">])</span>

<span class="n">Zlabel</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;$S$ [$m s^{-1}$]&#39;</span><span class="p">,</span><span class="s1">&#39;$WD$ [&#39;</span><span class="o">+</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\N{DEGREE SIGN}</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;]&#39;</span><span class="p">,</span><span class="s1">&#39;$\Theta$ [$K$]&#39;</span><span class="p">,</span><span class="s1">&#39;$TKE$ [$m^{2} s^{-2}$]&#39;</span><span class="p">)</span>
<span class="n">taxis_label</span> <span class="o">=</span> <span class="s1">&#39;UTC time in hours since &#39;</span> <span class="o">+</span> <span class="n">datefrom</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, $L_{avg}$ = &#39;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%.0f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">Lav</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; km, $t_{avg}$ = &#39;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%.0f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">tav</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; min&#39;</span>
<span class="n">zaxis_label</span> <span class="o">=</span> <span class="s1">&#39;$z$ [$m$]&#39;</span>
<span class="n">hoursFmt</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%H&#39;</span><span class="p">)</span>
<span class="n">Zlevels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">Zlevels</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Ztitle</span><span class="p">))</span>

<span class="n">hoursFmt</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%H&#39;</span><span class="p">)</span>
<span class="n">tticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">datefrom</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Ztitle</span><span class="p">),</span> <span class="mi">4</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">17</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">xrotor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">datefrom</span><span class="p">),</span> <span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">dateto</span><span class="p">)])</span>
<span class="n">yrotor1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Hhub</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">Drot</span><span class="p">,</span> <span class="n">Hhub</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">Drot</span><span class="p">])</span>
<span class="n">yrotor2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Hhub</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">Drot</span><span class="p">,</span> <span class="n">Hhub</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">Drot</span><span class="p">])</span>
<span class="n">cbleft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.125</span><span class="p">,</span><span class="mf">0.33</span><span class="p">,</span><span class="mf">0.53</span><span class="p">,</span><span class="mf">0.73</span><span class="p">])</span>
<span class="k">for</span> <span class="n">iax</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Ztitle</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">ix</span><span class="p">,</span><span class="n">iy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">iax</span><span class="p">,(</span><span class="nb">len</span><span class="p">(</span><span class="n">Ztitle</span><span class="p">),</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">CF0</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">iax</span><span class="p">],</span><span class="n">Y</span><span class="p">[</span><span class="n">iax</span><span class="p">],</span><span class="n">Z</span><span class="p">[</span><span class="n">iax</span><span class="p">],</span> <span class="n">Zlevels</span><span class="p">[</span><span class="n">iax</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">Zcmap</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xrotor</span><span class="p">,</span><span class="n">yrotor1</span><span class="p">,</span><span class="s1">&#39;--k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xrotor</span><span class="p">,</span><span class="n">yrotor2</span><span class="p">,</span><span class="s1">&#39;--k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="n">zlim</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">hoursFmt</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">tticks</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">iy</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">zaxis_label</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">iy</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">Ztitle</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ix</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ztitle</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.87</span><span class="p">)</span>
        <span class="n">cbar_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">cbleft</span><span class="p">[</span><span class="n">iy</span><span class="p">],</span><span class="mf">0.885</span><span class="p">,</span> <span class="mf">0.165</span><span class="p">,</span> <span class="mf">0.012</span><span class="p">])</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">CF0</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cbar_ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">Zlabel</span><span class="p">[</span><span class="n">iy</span><span class="p">],</span><span class="n">labelpad</span> <span class="o">=</span> <span class="o">-</span><span class="mi">42</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">Ztitle</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">taxis_label</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="mf">1.2</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]],</span> <span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c1">#fig.savefig(figname, bbox_inches=&#39;tight&#39;, dpi = 300)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Markdown</span><span class="p">,</span> <span class="n">display</span>
<span class="n">figcaption</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;**Fig 5. Time-height contour of horizontal wind speed $S$, direction $WD$, &quot;</span>
         <span class="s2">&quot;potential temperature $\Theta$ and turbulent kinetic energy $TKE$. Dotted lines &quot;</span>
         <span class="s2">&quot;denote a rotor diameter of 160 m at 120 m hub-height.**&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="n">figcaption</span><span class="p">))</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../../_images/windconditions_benchmarks_gabls_NEWAbenchmark_GABLS3DiurnalCycleBenchmarkForWindEnergy_2017_10_0.png" src="../../../../_images/windconditions_benchmarks_gabls_NEWAbenchmark_GABLS3DiurnalCycleBenchmarkForWindEnergy_2017_10_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<strong>Fig 5. Time-height contour of horizontal wind speed :math:`S`,
direction :math:`WD`, potential temperature :math:`Theta` and turbulent
kinetic energy :math:`TKE`. Dotted lines denote a rotor diameter of 160
m at 120 m hub-height.</strong></div>
</div>
</div>
<div class="section" id="Vertical-Profiles">
<h2>Vertical Profiles<a class="headerlink" href="#Vertical-Profiles" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [16]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># Specify the datetime at which you want to plot the vertical profiles</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2006</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Plot settings</span>
<span class="n">linespec</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="s1">&#39;b.-&#39;</span><span class="p">,</span><span class="s1">&#39;r.-&#39;</span><span class="p">,</span><span class="s1">&#39;c.-&#39;</span><span class="p">,</span><span class="s1">&#39;m-&#39;</span><span class="p">,</span><span class="s1">&#39;g-&#39;</span><span class="p">,</span><span class="s1">&#39;y-&#39;</span><span class="p">,</span><span class="s1">&#39;c-&#39;</span><span class="p">,</span><span class="s1">&#39;b-.&#39;</span><span class="p">,</span><span class="s1">&#39;r--&#39;</span><span class="p">]</span>
<span class="n">lwidth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">Nm</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># marker every</span>

<span class="n">Z_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">S_obs_w</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">t0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">WD_obs_w</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">t0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
         <span class="n">Th_obs_w</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">t0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">z_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">zf_obs</span><span class="p">,</span> <span class="n">zf_obs</span><span class="p">,</span> <span class="n">zT_obs</span><span class="p">)</span>

<span class="n">Z_sim</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">z_sim</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">iplot</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">plotsim</span><span class="p">)):</span>
    <span class="n">isim</span> <span class="o">=</span> <span class="n">plotsim</span><span class="p">[</span><span class="n">iplot</span><span class="p">]</span>
    <span class="n">Z_sim</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">S</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">t0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">WD</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">t0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                  <span class="n">Th</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">t0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
    <span class="n">z_sim</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">]))</span>

<span class="n">figname</span> <span class="o">=</span> <span class="n">siteID</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">t0</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">_%H&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_profiles.png&#39;</span>

<span class="n">zlim</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">iax</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Z_obs</span><span class="p">[</span><span class="n">iax</span><span class="p">],</span> <span class="n">z_obs</span><span class="p">[</span><span class="n">iax</span><span class="p">],</span> <span class="s1">&#39;ok&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;obs &#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">iplot</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">plotsim</span><span class="p">)):</span>
        <span class="n">isim</span> <span class="o">=</span> <span class="n">plotsim</span><span class="p">[</span><span class="n">iplot</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">isim</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">iax</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">aa</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Z_sim</span><span class="p">[</span><span class="n">iplot</span><span class="p">][</span><span class="n">iax</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="n">z_sim</span><span class="p">[</span><span class="n">iplot</span><span class="p">][</span><span class="n">iax</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span>
                <span class="n">linespec</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">lwidth</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">markevery</span><span class="o">=</span><span class="n">Nm</span><span class="p">)</span>
        <span class="c1">#ax[iax].set_yscale(&#39;log&#39;)</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xlim</span><span class="p">,</span><span class="n">yrotor1</span><span class="p">,</span><span class="s1">&#39;--k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xlim</span><span class="p">,</span><span class="n">yrotor2</span><span class="p">,</span><span class="s1">&#39;--k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="n">zlim</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>

<span class="c1">#ax[0].set_xlim([0, 16])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">60</span><span class="p">,</span> <span class="mi">180</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">285</span><span class="p">,</span> <span class="mi">300</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$S$ [$m s^{-1}$]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$WD$ [&#39;</span><span class="o">+</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\N{DEGREE SIGN}</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Theta$ [$K$]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$z$ [$m$]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$t_{0}$ = &#39;</span><span class="o">+</span> <span class="n">t0</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">:]],</span> <span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1">#fig.savefig(figname, bbox_inches=&#39;tight&#39;, format=&#39;png&#39;, dpi=300)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">figcaption</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;**Fig 7. Vertical profiles of wind speed, wind direction &quot;</span>
         <span class="s2">&quot;and potential temperature at UTC **&quot;</span><span class="o">+</span><span class="n">t0</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="n">figcaption</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../../_images/windconditions_benchmarks_gabls_NEWAbenchmark_GABLS3DiurnalCycleBenchmarkForWindEnergy_2017_12_0.png" src="../../../../_images/windconditions_benchmarks_gabls_NEWAbenchmark_GABLS3DiurnalCycleBenchmarkForWindEnergy_2017_12_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<strong>Fig 7. Vertical profiles of wind speed, wind direction and potential
temperature at UTC</strong>2006-07-02 00:00:00</div>
</div>
</div>
<div class="section" id="Quantities-of-Interest-and-Metrics">
<h2>Quantities of Interest and Metrics<a class="headerlink" href="#Quantities-of-Interest-and-Metrics" title="Permalink to this headline">¶</a></h2>
<p>The performance of the models is based on quantities of interest
relevant for wind energy applications. These quantities are evaluated
across a reference rotor span of 160 m, between 40 and 200 m,
characteristic of an 8-MW large wind turbine. Besides hub-height wind
speed <span class="math">\(S_{hub}\)</span> and direction <span class="math">\(WD_{hub}\)</span>, it is relevant to
consider the rotor-equivalent wind speed <span class="math">\(REWS\)</span>, the turbulence
intensity (not evaluated here), the wind speed shear <span class="math">\(\alpha\)</span>, and
the wind direction shear or veer <span class="math">\(\psi\)</span>.</p>
<p>The REWS is especially suitable to account for wind shear in wind
turbine power performance tests [14]. The REWS is the wind speed
corresponding to the kinetic energy flux through the swept rotor area,
when accounting for the vertical shear:</p>
<div class="math">
\[REWS = \left[\frac{1}{A}\sum_{i}(A_iS_i^3\cos\beta_i)\right]^{1/3}\]</div>
<p>where <span class="math">\(A\)</span> is the rotor area and <span class="math">\(A_i\)</span> are the horizontal
segments that separate vertical measurement points of horizontal wind
speed <span class="math">\(S_i\)</span> across the rotor plane. The <span class="math">\(REWS\)</span> is here
weighted by the cosine of the angle <span class="math">\(\beta_i\)</span> of the wind
direction <span class="math">\(WD_i\)</span> with respect to the hub-height wind direction to
account for the effect of wind veer [15].</p>
<p>Wind shear is defined by fitting a power-law curve across the rotor wind
speed points <span class="math">\(S_i\)</span>:</p>
<div class="math">
\[S_i = S_{hub}\left(\frac{z_i}{z_{hub}}\right)^{\alpha}\]</div>
<p>Similarly, wind veer is defined as the slope <span class="math">\(\psi\)</span> of the linear
fit of the wind direction difference:</p>
<div class="math">
\[\beta_i = \psi(z_i-z_{hub})\]</div>
<p>To evaluate simulations and measurements consistently, these quantities
are obtained after resampling, by linear interpolation, velocity and
wind direction vertical profiles at 10 points across the rotor area and
then computing the REWS and the shear functional fits. While these
fitting functions are commonly used in wind energy, their suitability in
LLJ conditions is questionable. The regression coefficient from the
fitting can be used to determine this suitability.</p>
<p>A rolling average with a window size of one hour is applied to
simulation and observational data to remove the impact of high frequency
fluctuations in the analysis.</p>
<p>Validation results are quantified in terms of the mean absolute error
(<span class="math">\(MAE\)</span>):</p>
<div class="math">
\[MAE = \frac{1}{N}\sum_{i=1}^{N}\left|\chi_{pred}-\chi_{obs}\right|\]</div>
<p>where <span class="math">\(\chi\)</span> is any of the above mentioned quantities of interest,
predicted (<em>pred</em>) or observed (<em>obs</em>), and <span class="math">\(N\)</span> is the number of
samples evaluated in the time series.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [17]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># Define rotor-based quantities of interest</span>
<span class="n">zrot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Hhub</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">Drot</span><span class="p">,</span> <span class="n">Hhub</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">Drot</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">Drot</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">rotor</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">Sz</span><span class="p">,</span><span class="n">WDz</span><span class="p">):</span>
    <span class="c1"># Rotor QoIs [m s-1]</span>
    <span class="c1"># z: heights [m] where the velocity and wind direction are known spanning the rotor diameter</span>
    <span class="c1"># Sz, WDz: Wind speed [m s-1] and direction [deg from N] at z levels [tdim,zdim]</span>
    <span class="c1"># Returns:</span>
    <span class="c1">#   REWS: rotor equivalent wind speed [m s-1]</span>
    <span class="c1">#   alpha: wind shear, power-law exponent from linear fit lg(U/Uhub) = alpha*log(z/zhub)</span>
    <span class="c1">#   alpha_R2: R-squared from least squares fit to linear function</span>
    <span class="c1">#   veer: wind veer, slope of linear function beta = WDz - WDhub = veer*(z - zhub)</span>
    <span class="c1">#   veer_R2: R-squared from least squares fit to linear function</span>
    <span class="n">tdim</span> <span class="o">=</span> <span class="n">Sz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">zdim</span> <span class="o">=</span> <span class="n">Sz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">Rrot</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">Hhub</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ihub</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">zrot</span><span class="p">))</span>
    <span class="n">Arotor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">Rrot</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">Uz</span> <span class="o">=</span> <span class="o">-</span><span class="n">Sz</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">WDz</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span>
    <span class="n">Vz</span> <span class="o">=</span> <span class="o">-</span><span class="n">Sz</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">WDz</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span>
    <span class="n">Shub</span> <span class="o">=</span> <span class="n">Sz</span><span class="p">[:,</span><span class="n">ihub</span><span class="p">]</span>
    <span class="n">WDhub</span> <span class="o">=</span> <span class="n">WDz</span><span class="p">[:,</span><span class="n">ihub</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">cz</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">H</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">R</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">H</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">sumA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Sz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">veer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Sz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">zdim</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">Ai</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">cz</span><span class="p">,</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">Rrot</span><span class="p">,</span><span class="n">Hhub</span><span class="p">))</span>
        <span class="n">Si</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Sz</span><span class="p">[:,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">Sz</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
        <span class="n">Ui</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Uz</span><span class="p">[:,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">Uz</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
        <span class="n">Vi</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Vz</span><span class="p">[:,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">Vz</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
        <span class="n">WDi</span> <span class="o">=</span> <span class="mf">180.</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">Ui</span><span class="p">,</span><span class="n">Vi</span><span class="p">)</span><span class="o">*</span><span class="mf">180.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">betai</span> <span class="o">=</span> <span class="n">WDi</span> <span class="o">-</span> <span class="n">WDhub</span>
        <span class="n">sumA</span> <span class="o">=</span> <span class="n">sumA</span> <span class="o">+</span> <span class="n">Ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">Si</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">betai</span><span class="o">/</span><span class="mf">180.</span><span class="p">))</span><span class="o">**</span><span class="mi">3</span>

    <span class="n">REWS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sumA</span><span class="o">/</span><span class="n">Arotor</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span>

    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">tdim</span><span class="p">);</span>    <span class="n">alpha_stderr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">tdim</span><span class="p">);</span> <span class="n">alpha_R2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">tdim</span><span class="p">)</span>
    <span class="n">veer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">tdim</span><span class="p">);</span>     <span class="n">veer_stderr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">tdim</span><span class="p">);</span> <span class="n">veer_R2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">tdim</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">tdim</span><span class="p">):</span>
        <span class="n">regmodel</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Sz</span><span class="p">[</span><span class="n">it</span><span class="p">,:]</span><span class="o">/</span><span class="n">Shub</span><span class="p">[</span><span class="n">it</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">z</span><span class="o">/</span><span class="n">Hhub</span><span class="p">))</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">regmodel</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">alpha</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">alpha_stderr</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">bse</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">alpha_R2</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">rsquared</span>
        <span class="n">regmodel</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">WDz</span><span class="p">[</span><span class="n">it</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">WDhub</span><span class="p">[</span><span class="n">it</span><span class="p">],</span> <span class="n">z</span> <span class="o">-</span> <span class="n">Hhub</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">regmodel</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">veer</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">veer_stderr</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">bse</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">veer_R2</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">rsquared</span>

    <span class="k">return</span> <span class="n">REWS</span><span class="p">,</span> <span class="n">Shub</span><span class="p">,</span> <span class="n">WDhub</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">alpha_R2</span><span class="p">,</span> <span class="n">veer</span><span class="p">,</span> <span class="n">veer_R2</span>

<span class="n">Srews_obs</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">zf_obs</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">34</span><span class="p">],</span><span class="n">date_obs</span><span class="p">,</span><span class="n">S_obs_w</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span><span class="mi">30</span><span class="p">:</span><span class="mi">34</span><span class="p">])(</span><span class="n">zrot</span><span class="p">,</span><span class="n">date_obs</span><span class="p">)</span>
<span class="n">Urews_obs</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">zf_obs</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">34</span><span class="p">],</span><span class="n">date_obs</span><span class="p">,</span><span class="n">U_obs_w</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span><span class="mi">30</span><span class="p">:</span><span class="mi">34</span><span class="p">])(</span><span class="n">zrot</span><span class="p">,</span><span class="n">date_obs</span><span class="p">)</span>
<span class="n">Vrews_obs</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">zf_obs</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">34</span><span class="p">],</span><span class="n">date_obs</span><span class="p">,</span><span class="n">V_obs_w</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span><span class="mi">30</span><span class="p">:</span><span class="mi">34</span><span class="p">])(</span><span class="n">zrot</span><span class="p">,</span><span class="n">date_obs</span><span class="p">)</span>
<span class="n">WDrews_obs</span> <span class="o">=</span> <span class="mf">180.</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">Urews_obs</span><span class="p">,</span><span class="n">Vrews_obs</span><span class="p">)</span><span class="o">*</span><span class="mf">180.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

<span class="n">REWS_obs</span><span class="p">,</span> <span class="n">Shub_obs</span><span class="p">,</span> <span class="n">WDhub_obs</span><span class="p">,</span> <span class="n">alpha_obs</span><span class="p">,</span> <span class="n">alpha_R2_obs</span><span class="p">,</span> <span class="n">veer_obs</span><span class="p">,</span> <span class="n">veer_R2_obs</span> <span class="o">=</span> <span class="n">rotor</span><span class="p">(</span><span class="n">zrot</span><span class="p">,</span><span class="n">Srews_obs</span><span class="p">,</span><span class="n">WDrews_obs</span><span class="p">)</span>

<span class="n">REWS</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">Shub</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">WDhub</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">alpha_R2</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">veer</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">veer_R2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">isim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Nsim</span><span class="p">):</span>
    <span class="n">Srews_sim</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span><span class="n">S</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)(</span><span class="n">zrot</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
    <span class="n">Urews_sim</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span><span class="n">U</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)(</span><span class="n">zrot</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
    <span class="n">Vrews_sim</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span><span class="n">V</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)(</span><span class="n">zrot</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
    <span class="n">WDrews_sim</span> <span class="o">=</span> <span class="mf">180.</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">Urews_sim</span><span class="p">,</span><span class="n">Vrews_sim</span><span class="p">)</span><span class="o">*</span><span class="mf">180.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">REWS0</span><span class="p">,</span> <span class="n">Shub0</span><span class="p">,</span> <span class="n">WDhub0</span><span class="p">,</span> <span class="n">alpha0</span><span class="p">,</span> <span class="n">alpha_R20</span><span class="p">,</span> <span class="n">veer0</span><span class="p">,</span> <span class="n">veer_R20</span> <span class="o">=</span> <span class="n">rotor</span><span class="p">(</span><span class="n">zrot</span><span class="p">,</span><span class="n">Srews_sim</span><span class="p">,</span><span class="n">WDrews_sim</span><span class="p">)</span>

    <span class="n">REWS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">REWS0</span><span class="p">)</span>
    <span class="n">Shub</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Shub0</span><span class="p">)</span>
    <span class="n">WDhub</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WDhub0</span><span class="p">)</span>
    <span class="n">alpha</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alpha0</span><span class="p">)</span>
    <span class="n">alpha_R2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alpha_R20</span><span class="p">)</span>
    <span class="n">veer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">veer0</span><span class="p">)</span>
    <span class="n">veer_R2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">veer_R20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [18]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># plot QoIs</span>
<span class="n">figname</span> <span class="o">=</span> <span class="n">siteID</span><span class="o">+</span><span class="s1">&#39;_QoIs_rotor.png&#39;</span>

<span class="n">taxis_label</span> <span class="o">=</span> <span class="s1">&#39;UTC time in hours since &#39;</span> <span class="o">+</span> <span class="n">datefrom</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, $D$ = &#39;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%.0f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">Drot</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; m, $H$ = &#39;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%.0f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">Hhub</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; m&#39;</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">date_obs</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="n">REWS_obs</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;ok&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;obs &#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">iplot</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">plotsim</span><span class="p">)):</span>
    <span class="n">isim</span> <span class="o">=</span> <span class="n">plotsim</span><span class="p">[</span><span class="n">iplot</span><span class="p">]</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">REWS</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">linespec</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span><span class="n">linewidth</span> <span class="o">=</span> <span class="n">lwidth</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span>
                        <span class="n">label</span> <span class="o">=</span> <span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">markevery</span><span class="o">=</span><span class="n">Nm</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$REWS$ [$m s^{-1}$]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">14.</span><span class="p">])</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">date_obs</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="n">WDhub_obs</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;ok&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;obs &#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">iplot</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">plotsim</span><span class="p">)):</span>
    <span class="n">isim</span> <span class="o">=</span> <span class="n">plotsim</span><span class="p">[</span><span class="n">iplot</span><span class="p">]</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">WDhub</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">linespec</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span><span class="n">linewidth</span> <span class="o">=</span> <span class="n">lwidth</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span>
                        <span class="n">label</span> <span class="o">=</span> <span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">markevery</span><span class="o">=</span><span class="n">Nm</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$WD_{hub}$ [&#39;</span><span class="o">+</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\N{DEGREE SIGN}</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">60.</span><span class="p">,</span> <span class="mf">180.</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">hoursFmt</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">tticks</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">datefrom</span><span class="p">),</span> <span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">dateto</span><span class="p">)])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">taxis_label</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">date_obs</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="n">alpha_obs</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;ok&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;obs &#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">iplot</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">plotsim</span><span class="p">)):</span>
    <span class="n">isim</span> <span class="o">=</span> <span class="n">plotsim</span><span class="p">[</span><span class="n">iplot</span><span class="p">]</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">alpha</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">linespec</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span><span class="n">linewidth</span> <span class="o">=</span> <span class="n">lwidth</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span>
                        <span class="n">label</span> <span class="o">=</span> <span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">markevery</span><span class="o">=</span><span class="n">Nm</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Wind Shear $\alpha$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">date_obs</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="n">veer_obs</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;ok&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;obs &#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">iplot</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">plotsim</span><span class="p">)):</span>
    <span class="n">isim</span> <span class="o">=</span> <span class="n">plotsim</span><span class="p">[</span><span class="n">iplot</span><span class="p">]</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">veer</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">linespec</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span><span class="n">linewidth</span> <span class="o">=</span> <span class="n">lwidth</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span>
                        <span class="n">label</span> <span class="o">=</span> <span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">markevery</span><span class="o">=</span><span class="n">Nm</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Wind Veer $\psi$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">hoursFmt</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">tticks</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">datefrom</span><span class="p">),</span> <span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">dateto</span><span class="p">)])</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">},</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.47</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=.</span><span class="mi">25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">#fig.savefig(figname, bbox_inches=&#39;tight&#39;, dpi = 300)</span>

<span class="n">figcaption</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;**Fig 6. Time series of rotor rotor-based quantities of interest used for validation**&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="n">figcaption</span><span class="p">))</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../../_images/windconditions_benchmarks_gabls_NEWAbenchmark_GABLS3DiurnalCycleBenchmarkForWindEnergy_2017_15_0.png" src="../../../../_images/windconditions_benchmarks_gabls_NEWAbenchmark_GABLS3DiurnalCycleBenchmarkForWindEnergy_2017_15_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<strong>Fig 6. Time series of rotor rotor-based quantities of interest used
for validation</strong></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [28]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">&#39;{:,.2f}&#39;</span><span class="o">.</span><span class="n">format</span>   <span class="c1"># format for output data in tables</span>

<span class="c1"># Compute error metics</span>
<span class="k">def</span> <span class="nf">mae</span><span class="p">(</span><span class="n">xtrue</span><span class="p">,</span> <span class="n">xpred</span><span class="p">,</span> <span class="n">norm</span><span class="p">):</span>
    <span class="c1"># Normalized Mean Absolute Error</span>
    <span class="c1"># xtrue: series with true values</span>
    <span class="c1"># xpred: series with predicted values</span>
    <span class="n">nonan</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xtrue</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span><span class="p">:</span>
        <span class="n">xtrue0</span> <span class="o">=</span> <span class="n">xtrue</span><span class="p">[</span><span class="n">nonan</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">xtrue</span><span class="p">[</span><span class="n">nonan</span><span class="p">])</span>
        <span class="n">xpred0</span> <span class="o">=</span> <span class="n">xpred</span><span class="p">[</span><span class="n">nonan</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">xtrue</span><span class="p">[</span><span class="n">nonan</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xtrue0</span> <span class="o">=</span> <span class="n">xtrue</span><span class="p">[</span><span class="n">nonan</span><span class="p">]</span>
        <span class="n">xpred0</span> <span class="o">=</span> <span class="n">xpred</span><span class="p">[</span><span class="n">nonan</span><span class="p">]</span>

    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xtrue0</span><span class="p">)</span>
    <span class="n">abserr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xpred0</span> <span class="o">-</span> <span class="n">xtrue0</span><span class="p">)</span>
    <span class="n">MAE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">abserr</span><span class="p">)</span><span class="o">/</span><span class="n">N</span>
    <span class="k">return</span> <span class="n">MAE</span>

<span class="c1"># Errors with respecto to observations</span>
<span class="n">Metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nsim</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
                       <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;REWS&#39;</span><span class="p">,</span><span class="s1">&#39;Shub&#39;</span><span class="p">,</span><span class="s1">&#39;WDhub&#39;</span><span class="p">,</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span><span class="s1">&#39;veer&#39;</span><span class="p">],</span>
                       <span class="n">index</span> <span class="o">=</span> <span class="n">simID</span><span class="p">)</span>
<span class="n">Metrics</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;m s-1&#39;</span><span class="p">,</span><span class="s1">&#39;m s-1&#39;</span><span class="p">,</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">isim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Nsim</span><span class="p">):</span>
    <span class="n">Metrics</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;REWS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">REWS_obs</span><span class="p">,</span><span class="n">REWS</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>
    <span class="n">Metrics</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;Shub&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">Shub_obs</span><span class="p">,</span><span class="n">Shub</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>
    <span class="n">Metrics</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;WDhub&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">WDhub_obs</span><span class="p">,</span><span class="n">WDhub</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>
    <span class="n">Metrics</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">alpha_obs</span><span class="p">,</span><span class="n">alpha</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>
    <span class="n">Metrics</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;veer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">veer_obs</span><span class="p">,</span><span class="n">veer</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>

<span class="n">tablecaption</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;**Table 2a. $MAE_{obs}$ with respect to observations**&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="n">tablecaption</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Metrics</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<strong>Table 1. :math:`MAE_{obs}` with respect to observations</strong></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>REWS</th>
      <th>Shub</th>
      <th>WDhub</th>
      <th>alpha</th>
      <th>veer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>WRF-YSU (ref)</th>
      <td>1.26</td>
      <td>1.35</td>
      <td>10.49</td>
      <td>0.13</td>
      <td>0.07</td>
    </tr>
    <tr>
      <th>WRF-YSU_LES</th>
      <td>1.51</td>
      <td>1.60</td>
      <td>10.67</td>
      <td>0.15</td>
      <td>0.06</td>
    </tr>
    <tr>
      <th>VentosM</th>
      <td>1.56</td>
      <td>1.59</td>
      <td>10.74</td>
      <td>0.12</td>
      <td>0.06</td>
    </tr>
    <tr>
      <th>CFDWind1D_ke</th>
      <td>1.56</td>
      <td>1.62</td>
      <td>11.49</td>
      <td>0.15</td>
      <td>0.06</td>
    </tr>
    <tr>
      <th>Alya-Wind1D_ke</th>
      <td>1.48</td>
      <td>1.42</td>
      <td>11.30</td>
      <td>0.14</td>
      <td>0.07</td>
    </tr>
    <tr>
      <th>Ellipsys1D_ke</th>
      <td>1.37</td>
      <td>1.50</td>
      <td>11.51</td>
      <td>0.16</td>
      <td>0.06</td>
    </tr>
    <tr>
      <th>Ellipsys3D_ke</th>
      <td>1.36</td>
      <td>1.52</td>
      <td>10.61</td>
      <td>0.16</td>
      <td>0.06</td>
    </tr>
    <tr>
      <th>Ellipsys3D_LES</th>
      <td>1.38</td>
      <td>1.37</td>
      <td>11.90</td>
      <td>0.18</td>
      <td>0.09</td>
    </tr>
    <tr>
      <th>SP-Wind_LES</th>
      <td>1.47</td>
      <td>1.38</td>
      <td>8.79</td>
      <td>0.13</td>
      <td>0.07</td>
    </tr>
    <tr>
      <th>WRF-YSU_GFS</th>
      <td>1.33</td>
      <td>1.30</td>
      <td>15.69</td>
      <td>0.14</td>
      <td>0.07</td>
    </tr>
    <tr>
      <th>WRF-YSU_ERA</th>
      <td>1.51</td>
      <td>1.51</td>
      <td>14.45</td>
      <td>0.14</td>
      <td>0.08</td>
    </tr>
    <tr>
      <th>WRF-TEMF_GFS</th>
      <td>1.23</td>
      <td>1.36</td>
      <td>11.62</td>
      <td>0.11</td>
      <td>0.10</td>
    </tr>
    <tr>
      <th>WRF-TEMF_ERA</th>
      <td>1.50</td>
      <td>1.57</td>
      <td>16.69</td>
      <td>0.10</td>
      <td>0.07</td>
    </tr>
    <tr>
      <th>WRF-QNSE_GFS</th>
      <td>1.35</td>
      <td>1.32</td>
      <td>13.21</td>
      <td>0.10</td>
      <td>0.06</td>
    </tr>
    <tr>
      <th>WRF-QNSE_ERA</th>
      <td>1.63</td>
      <td>1.62</td>
      <td>14.15</td>
      <td>0.10</td>
      <td>0.07</td>
    </tr>
    <tr>
      <th>WRF-MYNN_GFS</th>
      <td>1.21</td>
      <td>1.16</td>
      <td>18.27</td>
      <td>0.15</td>
      <td>0.09</td>
    </tr>
    <tr>
      <th>WRF-MYNN_ERA</th>
      <td>1.25</td>
      <td>1.19</td>
      <td>17.62</td>
      <td>0.16</td>
      <td>0.09</td>
    </tr>
    <tr>
      <th>WRF-MJY_GFS</th>
      <td>1.25</td>
      <td>1.26</td>
      <td>17.00</td>
      <td>0.13</td>
      <td>0.06</td>
    </tr>
    <tr>
      <th>WRF-MJY_ERA</th>
      <td>1.29</td>
      <td>1.22</td>
      <td>16.46</td>
      <td>0.14</td>
      <td>0.06</td>
    </tr>
    <tr>
      <th>WRF-Ensemble</th>
      <td>1.16</td>
      <td>1.12</td>
      <td>14.24</td>
      <td>0.11</td>
      <td>0.07</td>
    </tr>
    <tr>
      <th>units</th>
      <td>m s-1</td>
      <td>m s-1</td>
      <td>deg</td>
      <td>-</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [36]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># Errors with respect to reference simulation</span>
<span class="n">refsim</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">Metrics2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nsim</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
                       <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;REWS&#39;</span><span class="p">,</span><span class="s1">&#39;Shub&#39;</span><span class="p">,</span><span class="s1">&#39;WDhub&#39;</span><span class="p">,</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span><span class="s1">&#39;veer&#39;</span><span class="p">],</span>
                       <span class="n">index</span> <span class="o">=</span> <span class="n">simID</span><span class="p">)</span>
<span class="n">Metrics2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;m s-1&#39;</span><span class="p">,</span><span class="s1">&#39;m s-1&#39;</span><span class="p">,</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">isim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Nsim</span><span class="p">):</span>
    <span class="n">Metrics2</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;REWS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">REWS</span><span class="p">[</span><span class="n">refsim</span><span class="p">],</span><span class="n">REWS</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>
    <span class="n">Metrics2</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;Shub&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">Shub</span><span class="p">[</span><span class="n">refsim</span><span class="p">],</span><span class="n">Shub</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>
    <span class="n">Metrics2</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;WDhub&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">WDhub</span><span class="p">[</span><span class="n">refsim</span><span class="p">],</span><span class="n">WDhub</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>
    <span class="n">Metrics2</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">alpha</span><span class="p">[</span><span class="n">refsim</span><span class="p">],</span><span class="n">alpha</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>
    <span class="n">Metrics2</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;veer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">veer</span><span class="p">[</span><span class="n">refsim</span><span class="p">],</span><span class="n">veer</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>

<span class="n">tablecaption</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;**Table 2b: $MAE_{ref}$ with respect to **&quot;</span> <span class="o">+</span><span class="n">simID</span><span class="p">[</span><span class="n">refsim</span><span class="p">])</span>
<span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="n">tablecaption</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Metrics2</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<strong>Table 2b: :math:`MAE_{ref}` with respect to</strong>WRF-YSU (ref)</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>REWS</th>
      <th>Shub</th>
      <th>WDhub</th>
      <th>alpha</th>
      <th>veer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>WRF-YSU (ref)</th>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>WRF-YSU_LES</th>
      <td>0.45</td>
      <td>0.54</td>
      <td>4.09</td>
      <td>0.05</td>
      <td>0.03</td>
    </tr>
    <tr>
      <th>VentosM</th>
      <td>0.69</td>
      <td>0.72</td>
      <td>6.34</td>
      <td>0.05</td>
      <td>0.03</td>
    </tr>
    <tr>
      <th>CFDWind1D_ke</th>
      <td>0.63</td>
      <td>0.68</td>
      <td>6.22</td>
      <td>0.09</td>
      <td>0.05</td>
    </tr>
    <tr>
      <th>Alya-Wind1D_ke</th>
      <td>0.73</td>
      <td>0.70</td>
      <td>2.90</td>
      <td>0.07</td>
      <td>0.02</td>
    </tr>
    <tr>
      <th>Ellipsys1D_ke</th>
      <td>0.55</td>
      <td>0.61</td>
      <td>5.22</td>
      <td>0.10</td>
      <td>0.04</td>
    </tr>
    <tr>
      <th>Ellipsys3D_ke</th>
      <td>0.66</td>
      <td>0.74</td>
      <td>5.17</td>
      <td>0.09</td>
      <td>0.04</td>
    </tr>
    <tr>
      <th>Ellipsys3D_LES</th>
      <td>1.13</td>
      <td>1.27</td>
      <td>11.99</td>
      <td>0.09</td>
      <td>0.06</td>
    </tr>
    <tr>
      <th>SP-Wind_LES</th>
      <td>0.63</td>
      <td>0.69</td>
      <td>3.25</td>
      <td>0.04</td>
      <td>0.02</td>
    </tr>
    <tr>
      <th>WRF-YSU_GFS</th>
      <td>0.59</td>
      <td>0.59</td>
      <td>7.54</td>
      <td>0.07</td>
      <td>0.04</td>
    </tr>
    <tr>
      <th>WRF-YSU_ERA</th>
      <td>0.49</td>
      <td>0.50</td>
      <td>5.66</td>
      <td>0.04</td>
      <td>0.03</td>
    </tr>
    <tr>
      <th>WRF-TEMF_GFS</th>
      <td>1.09</td>
      <td>1.25</td>
      <td>10.08</td>
      <td>0.09</td>
      <td>0.06</td>
    </tr>
    <tr>
      <th>WRF-TEMF_ERA</th>
      <td>0.97</td>
      <td>1.10</td>
      <td>10.01</td>
      <td>0.07</td>
      <td>0.03</td>
    </tr>
    <tr>
      <th>WRF-QNSE_GFS</th>
      <td>0.90</td>
      <td>1.00</td>
      <td>5.17</td>
      <td>0.05</td>
      <td>0.03</td>
    </tr>
    <tr>
      <th>WRF-QNSE_ERA</th>
      <td>1.03</td>
      <td>1.15</td>
      <td>6.06</td>
      <td>0.04</td>
      <td>0.02</td>
    </tr>
    <tr>
      <th>WRF-MYNN_GFS</th>
      <td>0.65</td>
      <td>0.77</td>
      <td>9.69</td>
      <td>0.10</td>
      <td>0.05</td>
    </tr>
    <tr>
      <th>WRF-MYNN_ERA</th>
      <td>0.67</td>
      <td>0.77</td>
      <td>9.51</td>
      <td>0.11</td>
      <td>0.04</td>
    </tr>
    <tr>
      <th>WRF-MJY_GFS</th>
      <td>0.79</td>
      <td>0.89</td>
      <td>8.56</td>
      <td>0.08</td>
      <td>0.04</td>
    </tr>
    <tr>
      <th>WRF-MJY_ERA</th>
      <td>0.72</td>
      <td>0.84</td>
      <td>8.43</td>
      <td>0.07</td>
      <td>0.04</td>
    </tr>
    <tr>
      <th>WRF-Ensemble</th>
      <td>0.63</td>
      <td>0.76</td>
      <td>5.14</td>
      <td>0.05</td>
      <td>0.02</td>
    </tr>
    <tr>
      <th>units</th>
      <td>m s-1</td>
      <td>m s-1</td>
      <td>deg</td>
      <td>-</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [35]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># Metrics vs stability conditions</span>
<span class="n">zLbins</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>   <span class="c1"># bins</span>
<span class="n">zLbins_label</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">]</span>    <span class="c1"># stability classes</span>
<span class="n">iz</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># 10 m (fluxes at 3m are NaN)</span>
<span class="n">NzL</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zLbins_label</span><span class="p">)</span>
<span class="n">zL</span> <span class="o">=</span> <span class="n">zh_obs</span><span class="p">[</span><span class="n">iz</span><span class="p">]</span><span class="o">/</span><span class="n">L_obs</span><span class="p">[</span><span class="n">iz</span><span class="p">]</span>

<span class="n">idf</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">izL</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NzL</span><span class="p">):</span> <span class="n">idf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;REWS_&#39;</span><span class="o">+</span><span class="n">zLbins_label</span><span class="p">[</span><span class="n">izL</span><span class="p">])</span>
<span class="k">for</span> <span class="n">izL</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NzL</span><span class="p">):</span> <span class="n">idf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Shub_&#39;</span><span class="o">+</span><span class="n">zLbins_label</span><span class="p">[</span><span class="n">izL</span><span class="p">])</span>
<span class="k">for</span> <span class="n">izL</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NzL</span><span class="p">):</span> <span class="n">idf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;WDhub_&#39;</span><span class="o">+</span><span class="n">zLbins_label</span><span class="p">[</span><span class="n">izL</span><span class="p">])</span>
<span class="k">for</span> <span class="n">izL</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NzL</span><span class="p">):</span> <span class="n">idf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;alpha_&#39;</span><span class="o">+</span><span class="n">zLbins_label</span><span class="p">[</span><span class="n">izL</span><span class="p">])</span>
<span class="k">for</span> <span class="n">izL</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NzL</span><span class="p">):</span> <span class="n">idf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;veer_&#39;</span><span class="o">+</span><span class="n">zLbins_label</span><span class="p">[</span><span class="n">izL</span><span class="p">])</span>

<span class="n">Metrics3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nsim</span><span class="p">,</span><span class="mi">15</span><span class="p">)),</span>
                       <span class="n">index</span> <span class="o">=</span> <span class="n">simID</span><span class="p">,</span>
                       <span class="n">columns</span> <span class="o">=</span> <span class="n">idf</span><span class="p">)</span>
<span class="n">Metrics3</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;m s-1&#39;</span><span class="p">,</span><span class="n">NzL</span><span class="p">),</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;m s-1&#39;</span><span class="p">,</span><span class="n">NzL</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span><span class="n">NzL</span><span class="p">),</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">NzL</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">NzL</span><span class="p">)),</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">for</span> <span class="n">isim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Nsim</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">izL</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NzL</span><span class="p">):</span>
        <span class="n">i0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">zL</span> <span class="o">&gt;=</span> <span class="n">zLbins</span><span class="p">[</span><span class="n">izL</span><span class="p">],</span> <span class="n">zL</span> <span class="o">&lt;</span> <span class="n">zLbins</span><span class="p">[</span><span class="n">izL</span><span class="o">+</span><span class="mi">1</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Metrics3</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;REWS_&#39;</span><span class="o">+</span><span class="n">zLbins_label</span><span class="p">[</span><span class="n">izL</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">REWS</span><span class="p">[</span><span class="n">refsim</span><span class="p">][</span><span class="n">i0</span><span class="p">],</span><span class="n">REWS</span><span class="p">[</span><span class="n">isim</span><span class="p">][</span><span class="n">i0</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>
        <span class="n">Metrics3</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;Shub_&#39;</span><span class="o">+</span><span class="n">zLbins_label</span><span class="p">[</span><span class="n">izL</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">Shub</span><span class="p">[</span><span class="n">refsim</span><span class="p">][</span><span class="n">i0</span><span class="p">],</span><span class="n">Shub</span><span class="p">[</span><span class="n">isim</span><span class="p">][</span><span class="n">i0</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>
        <span class="n">Metrics3</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;WDhub_&#39;</span><span class="o">+</span><span class="n">zLbins_label</span><span class="p">[</span><span class="n">izL</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">WDhub</span><span class="p">[</span><span class="n">refsim</span><span class="p">][</span><span class="n">i0</span><span class="p">],</span><span class="n">WDhub</span><span class="p">[</span><span class="n">isim</span><span class="p">][</span><span class="n">i0</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>
        <span class="n">Metrics3</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;alpha_&#39;</span><span class="o">+</span><span class="n">zLbins_label</span><span class="p">[</span><span class="n">izL</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">alpha</span><span class="p">[</span><span class="n">refsim</span><span class="p">][</span><span class="n">i0</span><span class="p">],</span><span class="n">alpha</span><span class="p">[</span><span class="n">isim</span><span class="p">][</span><span class="n">i0</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>
        <span class="n">Metrics3</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;veer_&#39;</span><span class="o">+</span><span class="n">zLbins_label</span><span class="p">[</span><span class="n">izL</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">veer</span><span class="p">[</span><span class="n">refsim</span><span class="p">][</span><span class="n">i0</span><span class="p">],</span><span class="n">veer</span><span class="p">[</span><span class="n">isim</span><span class="p">][</span><span class="n">i0</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>

<span class="n">tablecaption</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;**Table 3: $MAE_{ref}$ for unstable ($u$), neutral ($n$) and stable ($s$) conditions.**&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="n">tablecaption</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Metrics3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<strong>Table 3: :math:`MAE_{ref}` for unstable (:math:`u`), neutral
(:math:`n`) and stable (:math:`s`) conditions.</strong></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>REWS_u</th>
      <th>REWS_n</th>
      <th>REWS_s</th>
      <th>Shub_u</th>
      <th>Shub_n</th>
      <th>Shub_s</th>
      <th>WDhub_u</th>
      <th>WDhub_n</th>
      <th>WDhub_s</th>
      <th>alpha_u</th>
      <th>alpha_n</th>
      <th>alpha_s</th>
      <th>veer_u</th>
      <th>veer_n</th>
      <th>veer_s</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>WRF-YSU (ref)</th>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>WRF-YSU_LES</th>
      <td>0.48</td>
      <td>0.44</td>
      <td>0.42</td>
      <td>0.58</td>
      <td>0.72</td>
      <td>0.48</td>
      <td>4.59</td>
      <td>4.15</td>
      <td>3.62</td>
      <td>0.03</td>
      <td>0.05</td>
      <td>0.08</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.03</td>
    </tr>
    <tr>
      <th>VentosM</th>
      <td>0.64</td>
      <td>0.75</td>
      <td>0.74</td>
      <td>0.68</td>
      <td>0.80</td>
      <td>0.73</td>
      <td>9.74</td>
      <td>7.02</td>
      <td>3.10</td>
      <td>0.04</td>
      <td>0.08</td>
      <td>0.05</td>
      <td>0.04</td>
      <td>0.02</td>
      <td>0.03</td>
    </tr>
    <tr>
      <th>CFDWind1D_ke</th>
      <td>0.74</td>
      <td>0.45</td>
      <td>0.56</td>
      <td>0.73</td>
      <td>0.53</td>
      <td>0.65</td>
      <td>5.62</td>
      <td>7.87</td>
      <td>6.53</td>
      <td>0.07</td>
      <td>0.10</td>
      <td>0.11</td>
      <td>0.05</td>
      <td>0.09</td>
      <td>0.05</td>
    </tr>
    <tr>
      <th>Alya-Wind1D_ke</th>
      <td>0.79</td>
      <td>0.39</td>
      <td>0.72</td>
      <td>0.78</td>
      <td>0.51</td>
      <td>0.66</td>
      <td>4.66</td>
      <td>3.16</td>
      <td>1.24</td>
      <td>0.09</td>
      <td>0.03</td>
      <td>0.06</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.03</td>
    </tr>
    <tr>
      <th>Ellipsys1D_ke</th>
      <td>0.58</td>
      <td>0.40</td>
      <td>0.55</td>
      <td>0.57</td>
      <td>0.40</td>
      <td>0.69</td>
      <td>4.30</td>
      <td>7.47</td>
      <td>5.75</td>
      <td>0.06</td>
      <td>0.12</td>
      <td>0.13</td>
      <td>0.03</td>
      <td>0.10</td>
      <td>0.05</td>
    </tr>
    <tr>
      <th>Ellipsys3D_ke</th>
      <td>0.67</td>
      <td>0.47</td>
      <td>0.68</td>
      <td>0.67</td>
      <td>0.60</td>
      <td>0.83</td>
      <td>4.13</td>
      <td>8.03</td>
      <td>5.70</td>
      <td>0.04</td>
      <td>0.14</td>
      <td>0.13</td>
      <td>0.02</td>
      <td>0.10</td>
      <td>0.04</td>
    </tr>
    <tr>
      <th>Ellipsys3D_LES</th>
      <td>0.56</td>
      <td>1.27</td>
      <td>1.64</td>
      <td>0.59</td>
      <td>1.06</td>
      <td>1.93</td>
      <td>11.69</td>
      <td>8.36</td>
      <td>12.81</td>
      <td>0.07</td>
      <td>0.10</td>
      <td>0.11</td>
      <td>0.02</td>
      <td>0.05</td>
      <td>0.11</td>
    </tr>
    <tr>
      <th>SP-Wind_LES</th>
      <td>0.48</td>
      <td>1.36</td>
      <td>0.66</td>
      <td>0.50</td>
      <td>1.38</td>
      <td>0.76</td>
      <td>3.00</td>
      <td>1.72</td>
      <td>3.71</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.06</td>
      <td>0.01</td>
      <td>0.02</td>
      <td>0.03</td>
    </tr>
    <tr>
      <th>WRF-YSU_GFS</th>
      <td>0.25</td>
      <td>0.32</td>
      <td>0.93</td>
      <td>0.30</td>
      <td>0.36</td>
      <td>0.90</td>
      <td>11.02</td>
      <td>7.93</td>
      <td>4.26</td>
      <td>0.04</td>
      <td>0.08</td>
      <td>0.09</td>
      <td>0.02</td>
      <td>0.05</td>
      <td>0.06</td>
    </tr>
    <tr>
      <th>WRF-YSU_ERA</th>
      <td>0.25</td>
      <td>0.70</td>
      <td>0.68</td>
      <td>0.26</td>
      <td>0.68</td>
      <td>0.69</td>
      <td>5.15</td>
      <td>5.16</td>
      <td>6.22</td>
      <td>0.03</td>
      <td>0.03</td>
      <td>0.06</td>
      <td>0.01</td>
      <td>0.04</td>
      <td>0.04</td>
    </tr>
    <tr>
      <th>WRF-TEMF_GFS</th>
      <td>0.60</td>
      <td>0.96</td>
      <td>1.56</td>
      <td>0.64</td>
      <td>1.12</td>
      <td>1.84</td>
      <td>10.71</td>
      <td>13.78</td>
      <td>8.95</td>
      <td>0.07</td>
      <td>0.13</td>
      <td>0.10</td>
      <td>0.07</td>
      <td>0.10</td>
      <td>0.04</td>
    </tr>
    <tr>
      <th>WRF-TEMF_ERA</th>
      <td>0.80</td>
      <td>0.97</td>
      <td>1.12</td>
      <td>0.87</td>
      <td>1.08</td>
      <td>1.32</td>
      <td>11.29</td>
      <td>16.15</td>
      <td>7.90</td>
      <td>0.03</td>
      <td>0.11</td>
      <td>0.09</td>
      <td>0.01</td>
      <td>0.01</td>
      <td>0.04</td>
    </tr>
    <tr>
      <th>WRF-QNSE_GFS</th>
      <td>0.83</td>
      <td>0.60</td>
      <td>1.00</td>
      <td>0.89</td>
      <td>0.71</td>
      <td>1.14</td>
      <td>6.03</td>
      <td>5.99</td>
      <td>4.26</td>
      <td>0.02</td>
      <td>0.06</td>
      <td>0.07</td>
      <td>0.02</td>
      <td>0.04</td>
      <td>0.03</td>
    </tr>
    <tr>
      <th>WRF-QNSE_ERA</th>
      <td>0.97</td>
      <td>1.32</td>
      <td>1.04</td>
      <td>1.04</td>
      <td>1.51</td>
      <td>1.20</td>
      <td>8.49</td>
      <td>7.03</td>
      <td>3.68</td>
      <td>0.01</td>
      <td>0.11</td>
      <td>0.06</td>
      <td>0.01</td>
      <td>0.02</td>
      <td>0.02</td>
    </tr>
    <tr>
      <th>WRF-MYNN_GFS</th>
      <td>0.41</td>
      <td>0.24</td>
      <td>0.94</td>
      <td>0.47</td>
      <td>0.35</td>
      <td>1.12</td>
      <td>11.89</td>
      <td>10.45</td>
      <td>7.55</td>
      <td>0.06</td>
      <td>0.18</td>
      <td>0.13</td>
      <td>0.03</td>
      <td>0.03</td>
      <td>0.06</td>
    </tr>
    <tr>
      <th>WRF-MYNN_ERA</th>
      <td>0.46</td>
      <td>0.54</td>
      <td>0.88</td>
      <td>0.53</td>
      <td>0.62</td>
      <td>1.01</td>
      <td>11.36</td>
      <td>9.90</td>
      <td>7.73</td>
      <td>0.06</td>
      <td>0.15</td>
      <td>0.15</td>
      <td>0.03</td>
      <td>0.03</td>
      <td>0.05</td>
    </tr>
    <tr>
      <th>WRF-MJY_GFS</th>
      <td>0.61</td>
      <td>0.53</td>
      <td>0.99</td>
      <td>0.69</td>
      <td>0.66</td>
      <td>1.11</td>
      <td>13.46</td>
      <td>8.29</td>
      <td>4.08</td>
      <td>0.08</td>
      <td>0.16</td>
      <td>0.08</td>
      <td>0.04</td>
      <td>0.02</td>
      <td>0.04</td>
    </tr>
    <tr>
      <th>WRF-MJY_ERA</th>
      <td>0.65</td>
      <td>0.69</td>
      <td>0.78</td>
      <td>0.70</td>
      <td>0.82</td>
      <td>0.97</td>
      <td>10.45</td>
      <td>9.53</td>
      <td>6.39</td>
      <td>0.09</td>
      <td>0.08</td>
      <td>0.05</td>
      <td>0.04</td>
      <td>0.03</td>
      <td>0.04</td>
    </tr>
    <tr>
      <th>WRF-Ensemble</th>
      <td>0.45</td>
      <td>0.51</td>
      <td>0.82</td>
      <td>0.51</td>
      <td>0.60</td>
      <td>1.02</td>
      <td>5.79</td>
      <td>8.98</td>
      <td>3.97</td>
      <td>0.03</td>
      <td>0.09</td>
      <td>0.06</td>
      <td>0.01</td>
      <td>0.02</td>
      <td>0.03</td>
    </tr>
    <tr>
      <th>units</th>
      <td>m s-1</td>
      <td>m s-1</td>
      <td>m s-1</td>
      <td>m s-1</td>
      <td>m s-1</td>
      <td>m s-1</td>
      <td>deg</td>
      <td>deg</td>
      <td>deg</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="Discussion">
<h2>Discussion<a class="headerlink" href="#Discussion" title="Permalink to this headline">¶</a></h2>
<p>[As per Sanz Rodrigo et al. (2017)]</p>
<p>All of the microscale models produce similar patterns of the diurnal
cycle, demonstrating the effectiveness of the offline coupling
methodology. Fig. 5 shows contour plots of the evolution of the vertical
profile of mean flow quantities computed by the participating models
compared to the observations on the top row. The second row corresponds
to the reference mesoscale model that is used to derive input forcings
and boundary conditions to drive the microscale simulations. Since no
additional information is added at microscale, we can assume that this
mesoscale simulation is already a good reference for microscale models
to verify a correct implementation of the meso-micro methodology. The
differences in the mean flow arise from the different ways each model
represents turbulence, which is noticed in the <span class="math">\(TKE\)</span> contour
plots.</p>
<p>The ensemble mean of the WRF simulations used in the sensitivity
analysis is plotted in the third row. By ensemble averaging, we obtain a
better match with the observations than by using any single WRF
simulation – this result was also seen for the LLJ cases discussed in
[34]. The ensemble here provides a better prediction of the LLJ with a
distinct velocity maximum around midnight instead of a broader
double-peak as in the reference WRF simulation.</p>
<p>The microscale models diverge in their estimates of rotor-based
quantities of interest. Time series of rotor-based quantities of
interest are shown in Fig. 3. The spread of the models for REWS is
around 2 <span class="math">\(m s^{-1}\)</span> and around 15º in terms of <span class="math">\(WD_{hub}\)</span>.
The spread in terms of wind shear and wind veer is also large specially
during nighttime stable conditions. Vertical profiles of wind speed and
direction at midnight (Fig. 7) show how the models capture the
characteristics of the LLJ. The phase error in the input data dominates
the bias in the simulations; this input error cannot be corrected at the
microscale by simply changing the turbulence model.</p>
<p>Table 2 summarize the differences between the simulations and
observations in terms of <span class="math">\(MAE\)</span> with respect to observations (Table
2a, <span class="math">\(MAE_{obs}\)</span>) and with respect to the reference WRF simulation
(Table 2b, <span class="math">\(MAE_{ref}\)</span>). These are differences integrated over the
whole diurnal cycle; therefore mixing all kinds of surface stability and
large-scale conditions into a single quantity. We shall focus on the
<span class="math">\(MAE_{ref}\)</span> to quantify the impact of choosing a different
turbulence model at microscale.</p>
<p>WRF-YSU_LES is the closest to the reference, which is to be expected
since they are results from different nests of the same simulation.
Still, differences are significant of around 0.5 <span class="math">\(m s^{-1}\)</span> of
wind speed and 4º of wind direction at hub-height. Microscale models
increase the error by 0.2-0.7 <span class="math">\(m s^{-1}\)</span> of wind speed and up to
7º of wind direction at hub-height with respect to the WRF-YSU_LES
results. With respect to observations, all simulations show similar
results with a <span class="math">\(MAE\)</span> of 1.1-1.6 <span class="math">\(m s^{-1}\)</span> of wind speed and
up to 14º of wind direction at hub-height. Considering vertical wind
speed shear and wind direction veer, SP-Wind and the WRF ensemble
produce the closest results to the reference WRF simulation.</p>
<p>Different sets of <span class="math">\(k-\epsilon\)</span> constants have been tested (not
shown) leading to changes that are within the spread shown in Figure 6,
which is also comparable to that observed in the WRF sensitivity
analysis when changing the planetary boundary-layer scheme.</p>
<p>Recently, capabilities of EllipSys3D have been extended to cover wall
modeled LES of stratified flows and at the same time, a “striped” down
1D version of the code have been made operational [28]. Figures 5 and 6
and Tables 2 and 3 show a general good agreement between URANS based
EllipSys1D and EllipSys3D computations. Some minor differences exist
thought; a possible cause of them might be related to the fact that the
vertical velocity (W) and the advection terms are implicitly assumed to
be zero in the EllipSys1D. Further investigations are necessary to
confirm this.</p>
<p>Initial LES computations based on coarse grid resolution and very basic
Smagorinsky SGS model show that EllipSys3D LES is capable of reproducing
the basic LLJ features observed at the Cabauw site, but Tables 2 and 3
MAE comparisons and Figures 2 and 3 indicate that significantly higher
resolution and a more advanced approach to SGS turbulence modeling are
needed in order to capture all main details relevant for its application
in a wind energy context.</p>
<p>Regarding VENTOS®/M wind speed results, both Figures 5 and 7 show that
the LLJ magnitude was reasonably well predicted. The diurnal cycle of
the simulation wind speed shows over-predictions around 1.4 m s-1,
affecting the REWS and Shub error values in Table 2 which are higher
than the reference simulation. Good agreement was obtained for the wind
direction, shear and veer regarding their integrated error. Analysis of
Figure 6 indicates a generalized under-prediction of α for several
nocturnal periods, analogous to a higher turbulent shape factor of the
boundary-layer. These mismatches happen also with WRF and, despite the
VENTOS®/M limitations of its heat-flux boundary condition, the
microscale simulation predicts higher values of α and closer to the
observations. The results further show a -2.5 K temperature bias that
occurs in both WRF and VENTOS®/M results, as well as in the other
microscale simulations, which originates from the ERA-Interim input
data.</p>
<p>Finally, Table 3 shows the <span class="math">\(MAE_{ref}\)</span> is computed for different
stability classes filtering with the observed stability parameter
<span class="math">\(z/L\)</span>, where <span class="math">\(L\)</span> is the Obukhov length and <span class="math">\(z\)</span> = 10 m:
unstable (‘<span class="math">\(u\)</span>’: <span class="math">\(z/L\)</span> &lt; -0.2), neutral (‘<span class="math">\(n\)</span>’: -0.2 &lt;
<span class="math">\(z/L\)</span> &lt; 0.2) and stable (‘<span class="math">\(s\)</span>’: <span class="math">\(z/L\)</span> &gt; 0.2). Not all
the models behave similarly depending on stability. The WRF ensemble
REWS is more sensitive in stable conditions. This is also the case for
Ellipsys3D_LES probably due to the coarser resolution of the simulation
compared to the other LES simulations that do not show this high
sensitivity in stable conditions.</p>
<p>In general, it is difficult to extract more meaningful conclusions from
Table 2 and Table 3 due to the limited statistical significance of the
samples. The overall assessment would be richer if several diurnal
cycles from uncorrelated synoptic conditions would have been tested. The
ensemble WRF simulations for the same cycle already show significant
improvement on mean flow quantities.</p>
</div>
<div class="section" id="Conclusions">
<h2>Conclusions<a class="headerlink" href="#Conclusions" title="Permalink to this headline">¶</a></h2>
<p>[As per Sanz Rodrigo et al. (2017)]</p>
<p>Results of the GABLS3 diurnal cycle benchmark with an emphasis on
rotor-relevant values are presented. The main challenge for microscale
models was to produce consistent flow fields with respect to the
mesoscale model that was used to derive their input forcings. This
consistency has been achieved by both LES and URANS models. The spread
of the models is significant but of similar magnitude as that shown by
WRF using different boundary-layer parameterizations. The input
uncertainty coming from the mesoscale, even in relatively ideal
conditions, is large and results in <span class="math">\(MAE\)</span> of wind speed at
hub-height of the order of 1.1-1.6 m s-1 over the whole cycle and and
hourly errors of up to 3 m s-1. This is partly mitigated when using an
ensemble average of several simulations which also lead to better
results in terms of wind shear and wind veer. By ensuring consistency of
the microscale models at introducing input forcings we can proceed with
further analysis on how RANS and LES models interpret the structure of
turbulence in different stability conditions.</p>
</div>
<div class="section" id="Acknowledgements">
<h2>Acknowledgements<a class="headerlink" href="#Acknowledgements" title="Permalink to this headline">¶</a></h2>
<p>This article was produced with funding from the “MesoWake” Marie Curie
International Outgoing Fellowship (FP7-PEOPLE-2013-IOF, European
Commission’s grant agreement number 624562). It also counts with
contributions supported by the New European Wind Atlas (NEWA,
FP7-ENERGY.2013.10.1.2 European Commission’s grant agreement number
618122). WRF-LES simulations have been produced using high-performance
computing resources from the PRACE-MesoWake project in the MareNostrum
system, based in Barcelona, Spain. The SP-Wind simulations were
performed with computational resources and services provided by the VSC
(Flemish Supercomputer Center), funded by the Research Foundation –
Flanders (FWO) and the Flemish Government – department EWI. JMT’s
mesoscale ensemble simulations were conducted using the Extreme Science
and Engineering Discovery Environment (XSEDE), which is supported by
National Science Foundation grant number ACI-1053575. JKL’s efforts were
supported by the National Renewable Energy Laboratory under APUP
UGA-0-41026-22. NREL is a national laboratory of the U. S. Department of
Energy, Office of Energy Efficiency and Renewable Energy, operated by
the Alliance for Sustainable Energy, LLC. The benchmark is organized
under the umbrella of the IEA-Wind Task 31 “Wakebench” Phase 2
(<a class="reference external" href="http://windbench.net/wakebench2">http://windbench.net/wakebench2</a>).</p>
</div>
<div class="section" id="References">
<h2>References<a class="headerlink" href="#References" title="Permalink to this headline">¶</a></h2>
<p>[1] Sanz Rodrigo J, Chávez Arroyo R-A, Moriarty P, Churchfield M,
Kosović B, Réthoré P-E, Hansen KS, Hahmann A, Mirocha JD and Rife D 2016
Mesoscale to microscale wind farm flow modelling and evaluation. WIREs
Energy Environ, doi:10.1002/wene.214</p>
<p>[2] Wyngaard JC 2004 Toward Numerical Modeling in the “Terra Incognita”.
J. Atmos. Sci. 61: 1816–1826, doi:
10.1175/1520-0469(2004)061&lt;1816:TNMITT&gt;2.0.CO;2</p>
<p>[3] Holtslag AAM, et al. (2013) Stable atmospheric boundary layers and
diurnal cycles—challenges for weather and climate models. Bull. Am.
Meteorol. Soc. 94: 1691–1706, doi:10.1175/bams-d-11-00187.1</p>
<p>[4] Baas, P., Bosveld, F.C., Baltink, K. and Holtslag, A.A.M. 2009 A
Climatology of Nocturnal Low-Level Jets at Cabauw, J. Appl. Meteorol.
Climatol. 48: 1627-1642, doi:10.1175/2009JAMC1965.1, 2009</p>
<p>[5] Bosveld FC, Baas P, vanMeijgaard E, de Bruijn EIF, Steeneveld GJ and
Holtslag AAM 2014 The third GABLS intercomparison case for evaluation
studies of boundary-layer models, Part A: case selection and set-up.
Boundary-Layer Meteorol. 152: 133-156, doi:10.1007/s10546-014-9917-3</p>
<p>[6] Bosveld FC et al.&nbsp;2014 The third GABLS Intercomparison case for
evaluation studies of Boundary-Layer Models Part B: Results and Process
Understanding, Boundary–Layer Meteorol. 152: 157-187, doi:
10.1007/s10546-014-9919-1</p>
<p>[7] Sanz Rodrigo J 2017 Windbench/GABLS3 benchmark.
<a class="reference external" href="http://windbench.net/gabls-3">http://windbench.net/gabls-3</a>, last accessed in March 2017</p>
<p>[8] Sanz Rodrigo, Churchfield M and Kosovic B 2016 A wind energy
benchmark for ABL modeling of a diurnal cycle with a nocturnal low-level
jet: GABLS3 revisited. J. Phys. Conf. Ser. 753: 032024,
doi:10.1088/1742-6596/753/3/032024</p>
<p>[9] Sanz Rodrigo J, Churchfield M and Kosović B 2017 A methodology for
the design and testing of atmospheric boundary layer models for wind
energy applications. Wind Energ. Sci. 2: 1-20, doi:10.5194/wes-2-1-2017</p>
<p>[10] Skamarock WC, Klemp JB, Dudhia J, Gill DO, Barker DM, Duda MG,
Huang X-Y, Wang W and Powers JG 2008 A description of the advanced
research WRF version 3, Technical Note NCAR/TN-475+STR, NCAR, Boulder,
CO, June 2008.</p>
<p>[11] Kleczek MA, Steeveneveld GL and Holtslag AAM 2014 Evaluation of the
Weather Research and Forecasting Mesoscale Model for GABLS3: Impact on
Boundary-Layer Schemes, Boundary Conditions and Spin-Up. Boundary-Layer
Meteorol. 152: 213-243, doi:10.1007/s10546-014-9925-3</p>
<p>[12] Hong S-Y and Noh Y 2006 A New Vertical Diffusion Package with an
Explicit Treatment of Entrainment Processes. Mon. Wea. Rev., 134:
2318–2341, doi: 10.1175/MWR3199.1</p>
<p>[13] Dee DP et al.&nbsp;2011 The ERA-Interim reanalysis: Configuration and
performance of the data assimilation system. Quart. J. R. Meteorol. Soc.
137: 553-597, doi: 10.1002/qj.828</p>
<p>[14] Wagner R, Cañadillas B, Clifton A, Feeney S, Nygaard N, Martin CSt,
Tüxen E and Wagenaar JW 2014 Rotor equivalent wind speed for power curve
measurement – comparative exercise for IEA Wind Annex 32. J. Phys. Conf.
Ser. 524: 012108, doi:10.1088/1742-6596/524/1/012108</p>
<p>[15] Choukulkar A, Pichugina Y, Clack CTM, Calhoun R, Banta R, Brewer A
and Hardesty M 2015 A new formulation for rotor equivalent wind speed
for wind resource assessment and wind power forecasting. Wind Energy 19:
1439–1452, doi:10.1002/we.1929</p>
<p>[16] Janjić ZI 1994 The Step-Mountain Eta Coordinate Model: Further
Developments of the Convection, Viscous Sublayer, and Turbulence Closure
Schemes. Mon. Wea. Rev.&nbsp;122: 927–945, doi:
10.1175/1520-0493(1994)122&lt;0927:TSMECM&gt;2.0.CO;2</p>
<p>[17] Nakanishi M and H Niino 2006 An Improved Mellor–Yamada Level-3
Model: Its Numerical Stability and Application to a Regional Prediction
of Advection Fog. Boundary-Layer Meteorol 119: 397-407,
doi:10.1007/s10546-005-9030-8.</p>
<p>[18] Sukoriansky S, Galperin B and Pero V 2005 Application of a New
Spectral Theory of Stably Stratified Turbulence to the Atmospheric
Boundary Layer over Sea Ice. Boundary-Layer Meteorol. 117: 231-257.
doi:10.1007/s10546-004-6848-4.</p>
<p>[19] Angevine&nbsp;WM 2005 An Integrated Turbulence Scheme for Boundary
Layers with Shallow Cumulus Applied to Pollutant Transport.&nbsp;J. Appl.
Meteor.&nbsp;44:&nbsp;1436–1452,&nbsp;doi: 10.1175/JAM2284.1.</p>
<p>[20] Veiga Rodrigues C, Palma JMLM and Rodrigues ÁH 2016 Atmospheric
Flow over a Mountainous Region by a One-Way Coupled Approach Based on
Reynolds-Averaged Turbulence Modelling. Boundary-Layer Meteorol.159:
407–437</p>
<p>[21] van de Wiel BJH, Moene AF, Steeneveld GJ, Hartogensis OK and
Holtslag AAM. 2007 Predicting the Collapse of Turbulence in Stably
Stratified Boundary Layers. Flow Turbulence Combust., 79:251–274</p>
<p>[22] Sogachev A, Kelly M and Leclerc MY 2012 Consistent Two-Equation
Closure Modelling for Atmospheric Research: Buoyancy and Vegetation
Implementations. Boundary-Layer Meteorol. 145: 307–327,
doi:10.1007/s10546-012-9726-5</p>
<p>[23] Deardorff J W 1980 Stratocumulus-capped mixed layers derived from a
three dimensional model. Boundary-Layer Meteorol. 18: 495-527,
doi:10.1007/BF00119502</p>
<p>[24] Avila M, Folch A, Houzeaux G, Eguzkitza B, Prieto L and Cabezon D
2013 A Parallel CFD Model for Wind Farms. Procedia Comput. Sci. 18: 2157
– 2166, doi:10.1016/j.procs.2013.05.386</p>
<p>[25] Vázquez M et al.&nbsp;2015 Alya: Multiphysics engineering simulation
toward exascale. J. Comput. Scie. 14: 15–27,
doi:10.1016/j.jocs.2015.12.007</p>
<p>[26] Michelsen JA 1994 Block structured Multigrid solution of 2D and 3D
elliptic PDE’s. Technical Report AFM 94-06, Technical University of
Denmark, Department of Fluid Mechanics, May 1994.</p>
<p>[27] Sørensen NN 1995 General Purpose Flow Solver Applied to Flow over
Hills. Risø-R-827-(EN), Risø National Laboratory, Roskilde, Denmark,
June 1995</p>
<p>[28] van der Laan MP and Sørensen NN 2017 A 1D version of EllipSys.
Technical Report, DTU Wind Energy E-0141, March 2017</p>
<p>[29] Meyers J, Meneveau C 2010 Large eddy simulations of large
wind-turbine arrays in the atmospheric boundary layer. AIAA Paper
No.&nbsp;2010-827, doi:10.2514/6.2010-827</p>
<p>[30] Munters W, Meneveau C and Meyers J 2016 Turbulent inflow precursor
method with time-varying direction for large-eddy simulations and
applications to wind farms. Boundary-Layer Meteorol. 159: 305-328,
doi:10.1007/s10546-016-0127-z</p>
<p>[31] Allaerts D and Meyers J 2017 Boundary-layer development and gravity
waves in conventionally neutral wind farms. J. Fluid Mech. 814: 95-130,
doi:10.1017/jfm.2017.11</p>
<p>[32] Moeng C-H 1984 A large-eddy-simulation model for the study of
planetary boundary-layer turbulence. J. Atmos. Sci. 41: 2052-2062,
doi:10.1175/1520-0469(1984)041&lt;2052:ALESMF&gt;2.0.CO;2</p>
<p>[33] Dyer A J 1974 A review of flux-profile relationships.
Boundary-Layer Meteorol. 7: 363-372, doi:10.1007/BF00240838</p>
<p>[34] Vanderwende BJ, Lundquist JK, Rhodes ME, Takle ES and Irvin SL 2015
Observing and Simulating the Summertime Low-Level Jet in Central Iowa.
Mon. Weater Rev.&nbsp;143(6): 2319–2336, doi:10.1175/mwr-d-14-00325.1</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


      </div>
    </div>
  </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../../../index.html">
    <img class="logo" src="../../../../_static/IEA_Wind_Logo.png" alt="Logo"/>
    
  </a>
</p>








<br>
<p>
Validate your code together with your peers and share your data safely to contribute to a traceable international model evaluation framework for the development of trustful wind energy engineering tools.
</p>
<br>
<h3>Navigation</h3>

<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../mep/mep.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mep/mep.html#scope-and-objectives">Scope and Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mep/mep.html#terminology">Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mep/mep.html#quick-guide">Quick Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mep/mep.html#validation-directed-program">Validation Directed Program</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mep/mep.html#verification">Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mep/mep.html#validation">Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mep/mep.html#uncertainty-quantification">Uncertainty Quantification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mep/mep.html#blind-testing">Blind Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mep/mep.html#documenting">Documenting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mep/mep.html#data-provision">Data Provision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mep/mep.html#references">References</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Wind Conditions</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../index.html#mep-implementation">MEP Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../index.html#challenges">Challenges</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../index.html#benchmarks">Benchmarks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../index.html#open-source-models">Open Source Models</a></li>
</ul>
</li>
</ul>



<br>

<h3>Communities</h3>

<br>

<h3>Useful Links</h3>
<ul>
  <li><a href="https://community.ieawind.org/home">IEA-Wind</a></li>
  <li><a href="https://windbench.net/">Windbench</a></li>
</ul>

<h3>Join our mailing list</h3>

<!-- Begin MailChimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
    #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
    /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
       We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form action="https://cener.us15.list-manage.com/subscribe/post?u=c93006a14497a28dc43ad2062&amp;id=5918172b7e" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
<div class="indicates-required"><span class="asterisk">*</span> indicates required</div>
<div class="mc-field-group">
    <label for="mce-EMAIL">Email Address  <span class="asterisk">*</span>
</label>
    <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
</div>
<div class="mc-field-group">
    <label for="mce-FNAME">First Name </label>
    <input type="text" value="" name="FNAME" class="" id="mce-FNAME">
</div>
<div class="mc-field-group">
    <label for="mce-LNAME">Last Name </label>
    <input type="text" value="" name="LNAME" class="" id="mce-LNAME">
</div>
    <div id="mce-responses" class="clear">
        <div class="response" id="mce-error-response" style="display:none"></div>
        <div class="response" id="mce-success-response" style="display:none"></div>
    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_c93006a14497a28dc43ad2062_5918172b7e" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>
<script type='text/javascript' src='//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script><script type='text/javascript'>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
<!--End mc_embed_signup-->


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
      <div class="container">
          <span style="float: left;">© Windbench 2018 </span>
          <span style="float: left;">
            &nbsp;<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a>
          </span>
          <span id="social-footer" class="pull-right">
            <span><a href="mailto:jsrodrigo@cener.com"><i class="iconf-email"></i>jsrodrigo@cener.com</a></span> |
            <span><a href="https://github.com/windbench/MEP"><i class="iconf-github-circled-alt2"></i>GitHub</a></span> |
            <span><a href="../../../../code-of-conduct.html">Code&nbsp;of&nbsp;Conduct</a></span>
          </span>
      </div>

    
    <a href="https://github.com//" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

</div>
  </body>
</html>